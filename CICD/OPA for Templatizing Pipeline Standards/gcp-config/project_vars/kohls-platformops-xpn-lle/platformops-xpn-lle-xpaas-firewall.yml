---
vpcs:
  platformops-nx-lle:
    firewallRules:
      # Rules For All OpenShift Environments
      openshift-ops-prv01-allow-bootstrap-ssh:
        priority: 900
        direction: INGRESS
        description: Allow ssh connectivity to bootstrap instance
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          - "10.126.128.0/17" # central lle supernet
          - "10.127.128.0/17" # east lle supernet
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "22"
      openshift-ops-prv01-allow-api:
        priority: 900
        direction: INGRESS
        description: Allow access to OCP API
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          - "10.126.128.0/17" # central lle supernet
          - "10.127.128.0/17" # east lle supernet
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "6443"
      openshift-ops-prv01-allow-health-checks:
        priority: 900
        direction: INGRESS
        description: Allow GCP ILB health checks
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          - "35.191.0.0/16"
          - "130.211.0.0/22"
          - "209.85.152.0/22"
          - "209.85.204.0/22"
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "6080"
            - "6443"
            - "22624"
      openshift-ops-prv01-allow-etcd:
        priority: 900
        direction: INGRESS
        description: Allow etcd connectivity between master nodes
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          sourceServiceAccounts:
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "2379-2380"
      openshift-ops-prv01-allow-control-plane:
        priority: 900
        direction: INGRESS
        description: Allow OCP nodes to talk across control plane
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          sourceServiceAccounts:
          - external: "ocp-app-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-infra-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-storage-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "10257"
            - "10259"
            - "22623"
      openshift-ops-prv01-allow-internal-network:
        priority: 900
        direction: INGRESS
        description: Allow SSH and ICMP connectivity to OCP nodes
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-app-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-infra-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-storage-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          - "10.126.128.0/17" # central lle supernet
          - "10.127.128.0/17" # east lle supernet
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "22"
          - protocol: "icmp"
      openshift-ops-prv01-allow-internal-cluster:
        priority: 900
        direction: INGRESS
        description: Allow node communication within OCP cluster
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-app-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-infra-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-storage-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          sourceServiceAccounts:
          - external: "ocp-app-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-infra-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-storage-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          sourceTags:
          allow:
          - protocol: "udp"
            ports:
            - "4789"
            - "6081"
            - "9000-9999"
            - "30000-32767"
          - protocol: "tcp"
            ports:
            - "9000-9999"
            - "10250"
            - "30000-32767"
      openshift-ops-prv01-allow-kohls-network:
        priority: 900
        direction: INGRESS
        description: Allow
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          - "10.0.0.0/8"
          - "172.26.0.0/15"
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "80"
            - "443"
            - "6443"
      openshift-ops-prv01-allow-kohls-asn-network:
        priority: 900
        direction: INGRESS
        description: Allow
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-router-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
            - "66.232.224.0/24"
            - "66.232.225.0/24"
            - "66.232.226.0/23"
            - "66.232.226.0/24"
            - "66.232.227.0/24"
            - "66.232.228.0/23"
            - "66.232.228.0/24"
            - "66.232.229.0/24"
            - "66.232.231.0/24"
            - "66.232.232.0/21"
            - "66.232.232.0/22"
            - "66.232.236.0/22"
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "443"
      openshift-ops-prv01-allow-pci-networks:
        priority: 900
        direction: INGRESS
        description: Allow Access to PCI Applications via OpenShift Routes
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-router-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          - "172.26.0.0/15"  # VPN range for testing
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "443"
      openshift-ops-prv01-allow-ssh:
        priority: 900
        direction: INGRESS
        description: Allow
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-app-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-bootstrap-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-infra-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-storage-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          - "10.57.0.0/16"  # KIC User Segment
          - "10.100.0.0/16" # Corp User Segment
          - "10.101.0.0/16" # Wireless User Segment
          - "172.26.0.0/15" # VPN
          - "10.126.128.0/17" # central lle supernet (xPaaS Jenkins)
          - "10.127.128.0/17" # east lle supernet (xPaaS Jenkins)
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "22"
      # Rules Only For OpenShift OPS Environment(do not promote to LLE and PRD)
      openshift-ops-prv01-allow-all:
        priority: 900
        direction: INGRESS
        description: Allow all Kohls and Google healthcheck traffic to open firewall
          Service Accounts
        disabled: false
        logging: false
        rule:
          destinationRanges:
          targetServiceAccounts:
          - external: "ocp-installer-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-master-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-bootstrap-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-app-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-infra-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-storage-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pci-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-router-pci-node-paas-open@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          - "10.0.0.0/8"
          - "172.26.0.0/15"
          - "130.211.0.0/22"
          - "35.191.0.0/16"
          - "209.85.152.0/22"
          - "209.85.204.0/22"
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
          - protocol: "udp"
          - protocol: "icmp"

      # Deny PCI/PII egress traffic
      openshift-ops-prv01-deny-egress:
        priority: 1000
        direction: EGRESS
        description: Deny PCI/PII egress traffic
        disabled: false
        logging: false
        rule:
          destinationRanges:
          - 172.26.0.0/15
          - 10.0.0.0/8
          targetServiceAccounts:
          - external: "ocp-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          sourceServiceAccounts:
          sourceTags:
          deny:
          - protocol: "tcp"
          - protocol: "udp"
          - protocol: "icmp"

      # Allow PCI/PII control plane traffic
      openshift-ops-prv01-allow-control-plane-egress:
        priority: 900
        direction: EGRESS
        description: Allow PCI/PII control plane egress traffic
        disabled: false
        logging: false
        rule:
          destinationRanges:
          - 10.187.10.0/23
          - 10.191.8.0/23
          targetServiceAccounts:
          - external: "ocp-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "6443"
            - "10257"
            - "10259"
            - "22623"

      # Allow PCI/PII proxy traffic
      openshift-ops-prv01-allow-proxy-egress:
        priority: 900
        direction: EGRESS
        description: Allow PCI/PII proxy egress traffic
        disabled: false
        logging: false
        rule:
          destinationRanges:
          - 10.206.126.0/27
          - 10.206.254.0/27
          targetServiceAccounts:
          - external: "ocp-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "8080"
            - "3128"

      # Allow PCI/PII DNS traffic
      openshift-ops-prv01-allow-dns-egress:
        priority: 900
        direction: EGRESS
        description: Allow PCI/PII DNS egress traffic
        disabled: false
        logging: false
        rule:
          destinationRanges:
          - 10.7.28.247/32
          - 10.185.10.10/32
          - 10.189.10.10/32
          - 10.220.0.247/32
          targetServiceAccounts:
          - external: "ocp-pci-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          - external: "ocp-pii-node-paas@kohls-platform-openshift-ops.iam.gserviceaccount.com"
          targetTags:
          sourceRanges:
          sourceServiceAccounts:
          sourceTags:
          allow:
          - protocol: "tcp"
            ports:
            - "53"
          - protocol: "udp"
            ports:
            - "53"
